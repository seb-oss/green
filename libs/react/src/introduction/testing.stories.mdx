import { Meta } from '@storybook/addon-docs'

<Meta title="Testing" />

# Testing React applications built with Green

## Jest

To test React applications using Green React, you need to add some extra configuration. Because
some of the components in Green are Web Components, and Jest runs in a Node environment, Jest
needs some browser APIs mocked. Also, the code in both the `@sebgroup/green-react` and `@sebgroup/green-core`
packages needs to be transformed by Babel before Jest can understand it. If you run into errors like
`Jest encountered an unexpected token`, this is probably the reason.

To make testing as seamless as possible, Green provides some pre-packaged configuration that you can apply to your Jest configuration.

### Babel config

First, you need to make sure that you have `babel-jest` installed in your project. If you don't, you can install it by running:

```bash
$ npm install --save-dev babel-jest @babel/core @babel/preset-env
```

Then, create a file called `babel.config.js` in the root of your project with the following content:

```js
module.exports = {
  presets: [['@babel/preset-env', { targets: { node: 'current' } }]],
}
```

### Jest config

To use the config from Green, you first need to make sure your Jest config is written in Javascript and not Typescript,
or else convert it. If you have a `jest.config.ts` file, rename it to `jest.config.cjs`.

Then, change the `const config = { ... }` to `module.exports = { ... }`. Also remove the `export default config` line.

Then, you can extend your configuration like this:

```js
// import green jest config
const greenJestConfig = require('@sebgroup/green-core/jest-config')

// apply the green jest config
module.exports = greenJestConfig.apply({
  // Your existing config, for example:
  transform: {
    '^.+\\.(ts|tsx)$': 'ts-jest',
  },
  clearMocks: true,
  coverageProvider: 'v8',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/setup-jest.ts'],
})
```

With both Babel and Jest properly configured, you should be able to test your app as usual with Jest.
